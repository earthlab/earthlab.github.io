---
layout: single
title: "Access secure data connections using the RCurl R package."
excerpt: "This lesson reviews how to use functions within the RCurl package to access data on a secure (https) server in R. "
authors: ['Carson Farmer', 'Leah Wasser']
modified: '`r format(Sys.time(), "%Y-%m-%d")`'
category: [course-materials]
class-lesson: ['intro-APIs-r']
permalink: /course-materials/earth-analytics/week-10/access-gapminder-data-rcurl-r/
nav-title: 'RCURL - gapminder'
week: 10
sidebar:
  nav:
author_profile: false
comments: true
order: 3
---


{% include toc title="In This Lesson" icon="file-text" %}

<div class='notice--success' markdown="1">

## <i class="fa fa-graduation-cap" aria-hidden="true"></i> Learning Objectives

After completing this tutorial, you will be able to:

* Access data from a secure website using getURL() and textConnection() functions in the RCurl package.

## <i class="fa fa-check-square-o fa-2" aria-hidden="true"></i> What you need

You will need a computer with internet access to complete this lesson and the
data that we already downloaded for week 6 of the course.

</div>

```{r echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning=FALSE)

```

```{r}
library(dplyr)
library(ggplot2)
library(RCurl)
```

## Download gapminder data with RCurl

Next, we will use functions in the RCurl package to download data from GitHub.
Note that this may work without RCurl but we will practice using RCurl in the examples
below. GitHub has secure (https) url's.

#### Gapminder Data

Let's grab a gapminder data subset from a secure URL located on
a GitHub website. The
<a href=" http://www.gapminder.org/about-gapminder/" target="_blank">Gapminder data</a>,
contain a suite of census like metrics that describe global development. The data
are ideal to experiment with when learning about plotting and working with data
in a tool like `R`.

<a href="https://twitter.com/JennyBryan" target="_blank">@jennybryan</a>
provides an `R` package to access the
<a href="http://www.gapminder.org/data/" target="_blank">Gapminder data</a> for
teaching. However, we will instead use `RCURL` to get it from
<a href="https://github.com/jennybc/gapminder" target="_blank">Jenny Bryan's Github Page</a>
to practice using RCurl functions.

```{r message=FALSE}
# Store base url (note the secure -- https:// -- url)
file = "https://raw.githubusercontent.com/jennybc/gapminder/master/inst/gapminder.tsv"
# grab the data!
temp = getURL(file)
```

In this case, using `read.csv()` may also work for you. But we will use `RCurl` to
ensure data are transferred properly from the secure url.

```{r}
# read.csv works too
head(read.csv(file, sep="\t"))

```

## Get Data with getURL()

Now that we have a connection to the Github `url`, we can treat it like a text
file, and read in the file using `read.csv()` via a `textConnection()` function:

```{r}
# Use textConnection to read content of temp as tsv
gap_data = read.csv(textConnection(temp))
head(gap_data)
```

Looking at our data, we have a separator. In this case it's `\t`. We can account
for this separator with the `sep=` argument.

```{r}
# Use textConnection to read content of temp as tsv
gap_data <- read.csv(textConnection(temp),
                     sep="\t")
head(gap_data)
```

Next, we can summarize and plot the data!

```{r life-by-continent, fig.cap="GGPLOT of gapminder data - life expectance by continent" }
# summarize the data - median value by content and year
summary_life_exp <-  gap_data %>%
   group_by(continent, year) %>%
   summarise(median_life = median(lifeExp))

ggplot(summary_life_exp, aes(x=year, y=median_life, colour = continent)) +
  geom_point() +
      labs(x="Continent",
           y="Life Expectancy (years)",
          title="Gapminder Data - Life Expectancy",
          subtitle = "Downloaded from Jenny Bryan's Github Page using getURL")

```


Notice that when we import the data from github, using `read.csv()`, it imports into
a `data.frame` format. Given it's a data.frame, we can plot the data using `ggplot()`
like we are used to.

Below, we make a boxplot of `lifeExp` by `continent`:

```{r box-plot-by-continent, fig.cap="GGPLOT of gapminder data - life expectance by continent boxplot"}
# create box plot
ggplot(summary_life_exp,
       aes(continent, median_life)) +
      geom_boxplot()+
      labs(x="Continent",
           y="Life Expentancy (years)",
          title="Gapminder Data - Life Expectancy",
          subtitle = "Downloaded from Jenny Bryan's Github Page using getURL")

```

We can also create a more advanced plot - overlaying the data points on top of
our box plot. See the <a href="http://docs.ggplot2.org" target="_blank"> ggplot documentation</a> to learn more advanced `ggplot()` plotting approaches.

```{r box-plot-point-jitter, fig.cap="GGPLOT of gapminder data - life expectance by continent with jitter and outliers."}
ggplot(gap_data, aes(x=continent, y=lifeExp)) +
  geom_boxplot(outlier.colour="hotpink") +
  geom_jitter(position=position_jitter(width=0.1, height=0), alpha=0.25)+
      labs(x="Continent",
           y="Life Expentancy (years)",
          title="Gapminder Data - Life Expectancy",
          subtitle = "Downloaded from Jenny Bryan's Github Page using getURL")
```

If you are going to be grabbing a lot of `csv` files from secure `urls`, you
might want to turn the previous code into a function:

```{r}
read_secure_csv_file = function(url) {
  url = getURL(url)
  return(read.csv(textConnection(url)))
}
```

<i class="fa fa-lightbulb-o" aria-hidden="true"></i> **Data Tip:** The web
changes constantly! Data available via a *particular* API at a *particular* point
in time may not be available indefinitely. Considering documenting workflows carefully.
{: .notice--success}
