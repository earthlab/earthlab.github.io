---
layout: single
title: "Introduction to APIs"
excerpt: "This lesson will cover the basic principles of using functions and why they are important."
authors: ['Carson Farmer', 'Leah Wasser']
modified: '2017-03-30'
category: [course-materials]
class-lesson: ['intro-APIs-r']
permalink: /course-materials/earth-analytics/week-10/intro-to-API-r/
nav-title: "API Intro"
module-title: "Introduction to API data access in R"
module-description: "In this module, we introduce various ways to access, download and work with data programmatically. These methods include downloading text files directly from a website onto your
computer and into R, reading in data stored in text format from a website, into a data.frame in R and finally, accessing subsets of particular data using REST and SOAP API's in R. "
module-nav-title: 'APIs'
module-type: 'class'
week: 10
sidebar:
  nav:
author_profile: false
comments: true
order: 1
---


{% include toc title="In This Lesson" icon="file-text" %}

<div class='notice--success' markdown="1">

## <i class="fa fa-graduation-cap" aria-hidden="true"></i> Learning Objectives

After completing this tutorial, you will be able to:

* Be able to describe the difference between human vs machine readable data structures.
* Be able to describe the difference between data returned using an API compared to downloading a text file directly.
* Be able to describe 2-3 components of a RESTful API call.

## <i class="fa fa-check-square-o fa-2" aria-hidden="true"></i> What you need

You will need a computer with internet access to complete this lesson.

</div>

## Access data programmatically

This week we will discuss programmatic access of data via Applied Programming
Interfaces (APIs). Up until this point, we have been downloading data from a
website (in the case of this course, <a href="https://figshare.com/authors/_/3386570" target="_blank">Figshare</a>). The data that we have downloaded
was prepared specifically for this course. However, downloading and unzipping data,
each week is not efficient. Sometimes we want to automate the data download process -
particularly when we are trying to download lots of data or particular subsets
of data to support an analysis.

Further, code that directly accesses particular data sets provides direct
documentation of where the data came from.


### 2 Ways to access data
We can break up programmatic data access into 2 general categories:

1. Data that we download directly by calling a specific URL and or by using the download.file() function call.
2. Data that we download using an API which makes a **request** to a data repository and **returns** requested data

### 2 key formats

The data that we access programmatically may be returned in one of two main formats:

1. **Tabular Human-readable file:** Files that are tabular in nature, including csv's (Comma Separated Values) and even spreadsheets (excel, etc).
2. **Structured Machine-readable files:** Files that may be text formatted by also may be hiearachical and structured in some way that optimizes machine readability.


### Download files programmatically

In week one of this course, we downloaded some data using the `download.file()`
function. In this case, we accessed data programmatically, but we first downloaded
it as a `.csv` to our computer, and then proceeded to work with it.


```r
# download text file to a specified location on our computer
download.file(url = "https://ndownloader.figshare.com/files/7010681",
             destfile = "data/week10/boulder-precip-aug-oct-2013.csv")
```



```r
# read data into R
boulder_precip <- read.csv("data/week10/boulder-precip-aug-oct-2013.csv")
```


|   X|DATE       | PRECIP|
|---:|:----------|------:|
| 756|2013-08-21 |    0.1|
| 757|2013-08-26 |    0.1|
| 758|2013-08-27 |    0.1|
| 759|2013-09-01 |    0.0|
| 760|2013-09-09 |    0.1|
| 761|2013-09-10 |    1.0|
| 762|2013-09-11 |    2.3|
| 763|2013-09-12 |    9.8|
| 764|2013-09-13 |    1.9|
| 765|2013-09-15 |    1.4|
| 766|2013-09-16 |    0.4|
| 767|2013-09-22 |    0.1|
| 768|2013-09-23 |    0.3|
| 769|2013-09-27 |    0.3|
| 770|2013-09-28 |    0.1|
| 771|2013-10-01 |    0.0|
| 772|2013-10-04 |    0.9|
| 773|2013-10-11 |    0.1|
### Human readable data

Notice that the data that we downloaded is **Tabular / human-readable**. It is tabular
with rows and columns that we can quickly understand. Ofcourse it is also
machine readable in the sense that `R` can import it into a data.frame structure
and we can work with it programmatically.

However, what would happen if our data structure were more complex. For example,
what is we wanted to store more information about each measured precipitation data
point? Our table could get very wide very quickly.

We will talk about structured machine readable data structures later in this module
which may be less easy for humans to quickly digest when we look at them but are much more efficient to process - particular as our data get large.

## What is an API?

An API is an interface that sits on top of a computer based system and simplifies
certain tasks such as - extracting subsets of data from a large repository or
database.

### What is a Web-API?

Web API's allow us to access data available via an internet web interface.

Often we can access data from web APIs via a URL that contains
sets of parameters that specifies the type and particular subset of data that
we are interested in.

If you have worked with a database such as `SQL` or `POSTSQL`, or if you've ever
queried data from a GIS system like ArcGIS, then you can compare the set of
parameters associated with a URL string to a SQL query.

> Web APIs are a way to strip away all the extraneous visual interface that
> you don’t care about and get the data that you want.

### Why Web APIs?

Among other things, APIs allow us to:

* Get information that would be time-consuming to get otherwise
* Get information that you can’t get otherwise
* Automate an analytical workflows that require continuously updated data
* Access data using a more direct interface

### 2 parts of an API request

When we talk about API's it's important to understand the two components: the
request and the response.

1. Data **REQUEST**: You try to access a `URL` in your browser.
2. **Data processing:** A web server somewhere uses that url to query a specified dataset.
3. Data **RESPONSE**: That web server then sends you back some content.

The **response** may give you one of two things:
1. Some *data* or
2. An explanation of why your request *failed*


<figure>
 <a href="https://docs.mulesoft.com/mule-user-guide/v/3.7/_images/Consume+REST+basic+anatomy.png">
 <img src="https://docs.mulesoft.com/mule-user-guide/v/3.7/_images/Consume+REST+basic+anatomy.png" alt="Restful response vs request."></a>
    <figcaption>First we create a request that queries the data repository for some data using the API. The repository gets the request and in turn processes it. Finally is responds. If our request was a good one, the response will include the data that we are interested in. Source: https://docs.mulesoft.com/mule-user-guide/v/3.7/consuming-a-rest-api
    </figcaption>
</figure>

### Restful web APIs

There are many different types of web APIs. One of the most common types is
a `REST`, or `REST`ful, API. A *RESTful* API is a web API that uses
a URL arguments to specify what information you want returned through the API.

Next, we will explore a restful API interface example.

### Colorado Population Projections

The <a href="https://data.colorado.gov" target="_blank">Colorado Information Marketplace</a>
is a data warehouse that provides access to a wide range of Colorado-specific
open datasets available via a **REST**ful API called the Socrata Open Data API (SODA)

There are lots of API *endpoints* or data sets available via this API.

* <a href="https://data.colorado.gov/browse" target="_blank">Check some of the data available on the site out in the browse section of the website. </a>
* <a href="https://data.colorado.gov/browse?category=Demographics" target="_blank">Check out the available demographic data. </a>
* <a href="https://data.colorado.gov/Demographics/Colorado-Population-Projections/q5vp-adf3" target="_blank">Colorado population projects data landing page. </a>


One
endpoint contains <a href="https://data.colorado.gov/resource/tv8u-hswn.json" target="_blank">Colorado Population Projections:</a>.
If you go to this site, you will see data returned
in a `JSON` format.

`JSON` is a **structured, machine readable format**. We will learn more about it in the
next lesson.

The CO population project data contain projected population estimates for *males* and
*females* for every *county* in Colorado for every *year* from 1990 to 2040 for
multiple *age* groups.


```json
[{"age":"0","county":"Adams","femalepopulation":"2404.00","fipscode":"1","malepopulation":"2354.00","totalpopulation":"4758","year":"1990"}
,{"age":"1","county":"Adams","femalepopulation":"2375.00","fipscode":"1","malepopulation":"2345.00","totalpopulation":"4720","year":"1990"}
,{"age":"2","county":"Adams","femalepopulation":"2219.00","fipscode":"1","malepopulation":"2413.00","totalpopulation":"4632","year":"1990"}
,{"age":"3","county":"Adams","femalepopulation":"2261.00","fipscode":"1","malepopulation":"2321.00","totalpopulation":"4582","year":"1990"}
,{"age":"4","county":"Adams","femalepopulation":"2302.00","fipscode":"1","malepopulation":"2433.00","totalpopulation":"4735","year":"1990"},
...
]
```

### URL Parameters

Using `URL` parameters, we can define a more specific request to limit what data
we get back in **response** to our API request. For example, we can query the data
to only return data for Boulder County, Colorado using the RESTful call.

<i class="fa fa-lightbulb-o" aria-hidden="true"></i> **Data Tip:** Note the **?&county=Boulder** part of the url below. That is an important part of the API
request that tells the API to only return a subset of the data - where county = Boulder. `https://data.colorado.gov/resource/tv8u-hswn.json?&county=Boulder`
{: .notice--success}

<a href="https://data.colorado.gov/resource/tv8u-hswn.json?&county=Boulder" target="_blank">Like this - https://data.colorado.gov/resource/tv8u-hswn.json?&county=Boulder</a>.

Notice that when we visit the URL above, we see that now the response is filtered
to only include Boulder County data.

```json
[{"age":"66","county":"Boulder","femalepopulation":"649","fipscode":"13","malepopulation":"596","totalpopulation":"1245","year":"1997"}
,{"age":"78","county":"Boulder","femalepopulation":"427","fipscode":"13","malepopulation":"258","totalpopulation":"685","year":"1992"}
,{"age":"85","county":"Boulder","femalepopulation":"265","fipscode":"13","malepopulation":"110","totalpopulation":"375","year":"1991"}
,{"age":"74","county":"Boulder","femalepopulation":"516","fipscode":"13","malepopulation":"373","totalpopulation":"889","year":"1996"},
...
]
```

Parameters associated with accessing data using this API are <a href="https://dev.socrata.com/foundry/data.colorado.gov/tv8u-hswn" target="_blank">documented here</a>.

## Using the SODA RESTful API

The `SODA` RESTful API also allows us to specify more complex 'queries'. Here's the API `URL`
for population projections for female Boulderites aged 20--40 for the years 2016-2025:

`https://data.colorado.gov/resource/tv8u-hswn.json?$where=age between 20 and 40 and year between 2016 and 2025&county=Boulder&$select=year,age,femalepopulation`

```json
[{"age":"32","femalepopulation":"2007","year":"2024"}
,{"age":"35","femalepopulation":"1950","year":"2016"}
,{"age":"37","femalepopulation":"2039","year":"2019"}
,{"age":"30","femalepopulation":"2087","year":"2025"}
,{"age":"26","femalepopulation":"1985","year":"2019"}
,{"age":"22","femalepopulation":"3207","year":"2016"}
...
]
```

<a href="https://data.colorado.gov/resource/tv8u-hswn.json?$where=age between 20 and 40 and year between 2016 and 2025&county=Boulder&$select=year,age,femalepopulation" target="_blank"> Click here to view the full API response</a>.


### Breaking down an API string

Notice that the `colorado.data.gov` API URL above, starts with
`data.colorado.gov` but then has various parameters attached to the end of the URL
that specify the particular type of information that we are looking for.

A few of the parameters that we can see in the url below are listed below:

* **The Data set itself:** /tv8u-hswn.json
* **AGE:** where=age between 20 and 40
* **YEAR:** year between 2016 and 2025
* **COUNTY:** county=Boulder
* **Columns to get:** select=year,age,femalepopulation

### JSON structured text format API Response

The response data that are returned from this API are in a text format, structured
using `JSON`.

<div class="notice--warning" markdown="1">
<i class="fa fa-lightbulb-o" aria-hidden="true"></i> **Data Tip:**
Many APIs allow you to specify the file format that you want to be returned. Learn more about how this works with the CO data warehouse<a href="https://dev.socrata.com/docs/formats/index.html" "target=_blank"> here.</a>

* https://data.colorado.gov/resource/tv8u-hswn.json
* https://data.colorado.gov/resource/tv8u-hswn.geojson
* https://data.colorado.gov/resource/tv8u-hswn.xml
* https://data.colorado.gov/resource/tv8u-hswn.csv

</div>


Notice that the first few rows of data returned via the query above with a `.csv`
suffix look like this:

```json
"age","femalepopulation","year"
"32","2007","2024"
"35","1950","2016"
"37","2039","2019"
"30","2087","2025"
"26","1985","2019"
...
```



Here is a different application of the same type of API. Here, the website developers <a href="https://data.colorado.gov/Demographics/Population-Colorado/eeah-cmy8" target="_blank">have built a tabular viewer that we can use to look at and interact with the population data.
</a> These data are the same data that we can download using the restful API
url string above. However, the developers have wrapped the API in a cool interface
that allows us to view the data directly, online.



We will work with these data in R directly in the following lessons, but for now
just notice how the API access works in this case.

1. Data **REQUEST**: You try to access a `URL` in your browser.
2. **Data processing:** A web server somewhere uses that url to query a specified dataset.
3. Data **RESPONSE**: That web server then sends you back some content.


## Getting to know JSON

Let's have a closer look at the data that the Colorado.gov API data returns.
These data are returned in **JSON** format - which we will discuss in  more detail
later in this week's lessons.


```json
[ {
  "totalpopulation" : "4758",
  "year" : "1990",
  "county" : "Adams",
  "malepopulation" : "2354.00",
  "fipscode" : "1",
  "femalepopulation" : "2404.00",
  "age" : "0"
}
, {
  "totalpopulation" : "4720",
  "year" : "1990",
  "county" : "Adams",
  "malepopulation" : "2345.00",
  "fipscode" : "1",
  "femalepopulation" : "2375.00",
  "age" : "1"
}]

```

Notice **JSON** is a structured format. The consistency of its structure makes
it easier for us to access and work with it programmatically. This is a
**computer readable** format.


<div class="notice--info" markdown="1">

## Additional Resources

### More about JSON

* <a href="http://www.w3resource.com/JSON/introduction.php" target="_blank">JSON tutorial</a>

### Using APIs

So, how do we learn more about APIs? Below are some resources ...

* <a href="http://www.programmableweb.com" target="_blank">Find APIs and read more about them</a>
* <a href="https://dev.twitter.com/overview/documentation" target="_blank">Twitter API documentation</a>
* <a href="http://developer.nytimes.com/docs" target="_blank">New York times API information</a>
* <a href="https://www.wunderground.com/weather/api" target="_blank">Weather underground API information</a>
* <a href="http://envirocar.github.io/enviroCar-server/api/" target="_blank">EnviroCar API information</a>
* <a href="http://developer.nytimes.com/docs" target="_blank">New York times API information</a>

The documentation in the URL's above describes the different types of *requests*
that we can make to the data provider. For each request `URL` we need to specify
the parameters and consider the response.

</div>
